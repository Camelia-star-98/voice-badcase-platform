# 出现位置功能更新说明

## 📝 更新内容

在新建Badcase表单中添加了"出现位置"字段，用于区分问题出现的具体场景，并根据不同的场景显示对应的ID输入框。

---

## ✨ 新增功能

### 1. 出现位置选择

在"学科"字段下方新增了"出现位置"下拉选择框，包含两个选项：

- **全程TTS做课部分** - 问题出现在全程TTS做课场景中
- **行课互动部分** - 问题出现在行课互动场景中

### 2. 动态ID输入框

根据选择的"出现位置"，表单会显示不同的ID输入框：

#### 选择"全程TTS做课部分"时：
- 显示：**全程TTS课节ID** 输入框（必填）
- 隐藏：CMS课节ID输入框
- 🆕 **隐藏：问题模型ID输入框**（全程TTS场景不需要模型ID）

#### 选择"行课互动部分"时：
- 显示：**CMS课节ID** 输入框（必填）
- 显示：**问题模型ID** 输入框（必填）
- 隐藏：全程TTS课节ID输入框

### 3. 表格显示优化

在Badcase列表和流转状态两个页面的表格中：

- 原来的"CMS课程ID"列替换为：
  - **出现位置** - 显示选择的位置类型
  - **课节ID** - 根据位置类型显示对应的ID

---

## 🔍 功能详情

### 数据结构更新

在 `BadcaseData` 类型中新增了以下字段：

```typescript
interface BadcaseData {
  // ... 其他字段
  location?: string;           // 出现位置：'fullTTS' 或 'interactive'
  fullTtsLessonId?: string;   // 全程TTS课节ID
  cmsId?: string;             // CMS课节ID（现在表示行课互动的课节ID）
}
```

### 表单字段说明

1. **出现位置（必填）**
   - 字段名：`location`
   - 类型：下拉选择
   - 选项：
     - 全程TTS做课部分 (值: `fullTTS`)
     - 行课互动部分 (值: `interactive`)

2. **全程TTS课节ID（条件必填）**
   - 字段名：`fullTtsLessonId`
   - 类型：文本输入
   - 显示条件：当出现位置 = 全程TTS做课部分
   - 验证：必填

3. **CMS课节ID（条件必填）**
   - 字段名：`cmsId`
   - 类型：文本输入
   - 显示条件：当出现位置 = 行课互动部分
   - 验证：必填

4. **问题模型ID（条件必填）** 🆕
   - 字段名：`modelId`
   - 类型：下拉选择
   - 显示条件：当出现位置 = 行课互动部分
   - 验证：必填
   - 说明：全程TTS场景不需要填写问题模型ID

---

## 📋 使用流程

### 新建Badcase时

1. 选择学科
2. **【新增】选择出现位置**
   - 如果问题出现在全程TTS做课场景 → 选择"全程TTS做课部分"
   - 如果问题出现在行课互动场景 → 选择"行课互动部分"
3. **【新增】根据选择填写对应的ID**
   - 选了"全程TTS做课部分" → 填写"全程TTS课节ID"，**不需要填写问题模型ID**
   - 选了"行课互动部分" → 填写"CMS课节ID"和"问题模型ID"
4. 继续填写问题提报人等其他信息
5. 提交表单

### 查看Badcase时

在表格中可以看到：

| ID | 提交日期 | 学科 | **出现位置** | **课节ID** | ... |
|----|---------|------|-------------|-----------|-----|
| BC0001 | 2025-12-22 | 语文 | 全程TTS做课部分 | TTS123456 | ... |
| BC0002 | 2025-12-22 | 数学 | 行课互动部分 | CMS789012 | ... |

在详情中可以看到：

- **出现位置**：全程TTS做课部分 / 行课互动部分
- **全程TTS课节ID** 或 **CMS课节ID**（根据位置显示对应的ID）

---

## 🎯 更新的文件

### 1. `src/types/index.ts`
- 更新 `BadcaseData` 接口
- 添加 `location`、`fullTtsLessonId` 字段
- 更新 `cmsId` 字段的注释说明

### 2. `src/pages/BadcaseListPage.tsx`
- 添加 `selectedLocation` 状态管理
- 在表单中添加"出现位置"选择器
- 添加条件渲染逻辑，根据位置显示不同的ID输入框
- 更新表单提交逻辑，保存位置和对应的ID
- 更新表格列定义，显示"出现位置"和"课节ID"
- 更新详情Modal，显示位置和对应的ID

### 3. `src/pages/StatusFlowPage.tsx`
- 更新表格列定义，与BadcaseListPage保持一致
- 更新详情Modal，显示位置和对应的ID

---

## ✅ 验证步骤

### 测试1：全程TTS做课场景

1. 点击"新建Badcase"
2. 选择学科：任意
3. 选择出现位置：**全程TTS做课部分**
4. 确认显示"全程TTS课节ID"输入框
5. 🆕 **确认"问题模型ID"输入框不显示**
6. 填写全程TTS课节ID：TEST-TTS-001
7. 填写其他必填项（问题提报人、分类、期望修复时间、问题描述）
8. 提交表单
9. 确认列表中显示：
   - 出现位置：全程TTS做课部分
   - 课节ID：TEST-TTS-001
10. 点击"查看"，确认详情中：
    - 显示全程TTS课节ID
    - 🆕 **只在选择行课互动时显示问题模型ID**

### 测试2：行课互动场景

1. 点击"新建Badcase"
2. 选择学科：任意
3. 选择出现位置：**行课互动部分**
4. 确认显示"CMS课节ID"输入框
5. 🆕 **确认显示"问题模型ID"输入框**
6. 填写CMS课节ID：CMS-123456
7. 选择问题模型ID：任意模型
8. 填写其他必填项
9. 提交表单
10. 确认列表中显示：
    - 出现位置：行课互动部分
    - 课节ID：CMS-123456
11. 点击"查看"，确认详情中：
    - 显示CMS课节ID
    - 🆕 **显示问题模型ID**

### 测试3：切换出现位置

1. 点击"新建Badcase"
2. 选择出现位置：全程TTS做课部分
3. 填写全程TTS课节ID：TTS-001
4. 切换出现位置为：行课互动部分
5. 确认之前填写的TTS-001被清空
6. 确认显示CMS课节ID输入框
7. 🆕 **确认显示问题模型ID输入框**
8. 填写CMS课节ID和选择问题模型ID
9. 切换回：全程TTS做课部分
10. 🆕 **确认CMS课节ID和问题模型ID被清空**
11. 填写全程TTS课节ID并提交
12. 确认数据正确保存

### 测试4：两个页面一致性

1. 在Badcase列表页面新建一条记录
2. 记录出现位置和课节ID的值
3. 切换到流转状态页面
4. 确认显示的出现位置和课节ID与Badcase列表一致
5. 点击"查看"详情，确认详情信息一致

---

## 🔄 数据兼容性

### 旧数据处理

对于在更新前创建的旧数据（没有 `location` 字段）：

- **表格显示**：出现位置列显示"-"
- **课节ID列**：如果有 `cmsId`，显示该值；否则显示"-"
- **详情页面**：出现位置显示"未填写"

### 建议处理方案

如需更新旧数据，可以：

1. 在流转状态页面找到旧数据
2. 判断原有的 `cmsId` 字段的含义
3. 手动补充 `location` 字段（需要开发额外的编辑功能）

或者：

- 保持旧数据不变，新数据按新规范填写即可

---

## 📊 表单字段顺序

更新后的表单字段顺序：

1. ✅ 学科（必填）
2. 🆕 **出现位置（必填）**
3. 🆕 **全程TTS课节ID / CMS课节ID（条件必填）**
4. ✅ 问题提报人（必填）
5. 🆕 **问题模型ID（条件必填 - 仅行课互动部分需要）**
6. ✅ 分类（必填）
7. ✅ 期望修复时间（必填）
8. ✅ 问题描述（必填）
9. ✅ 音频文件（可选）

**重要说明：**
- 当选择"全程TTS做课部分"时，问题模型ID字段不显示，也不需要填写
- 当选择"行课互动部分"时，问题模型ID字段显示，且为必填项

---

## 🎉 更新完成

**更新时间**：2025-12-22  
**版本**：v2.2.0  
**状态**：✅ 已完成并测试通过  
**影响范围**：
- ✅ 新建Badcase表单
- ✅ Badcase列表展示
- ✅ 流转状态展示
- ✅ 详情页面展示
- ✅ 数据类型定义

---

## 💡 注意事项

1. **必填验证**
   - "出现位置"为必填项
   - 根据选择的位置，对应的ID字段也为必填

2. **字段清空**
   - 切换出现位置时，会自动清空已填写的ID字段
   - 避免数据混淆

3. **数据一致性**
   - Badcase列表和流转状态两个页面的显示逻辑完全一致
   - 确保数据展示的一致性

4. **向后兼容**
   - 旧数据（没有location字段）仍可正常显示
   - 出现位置显示为"-"或"未填写"

---

## 📞 技术支持

如有问题，请联系开发团队。

**开发者**：AI Assistant  
**更新日期**：2025-12-22

