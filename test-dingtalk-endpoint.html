<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æµ‹è¯•é’‰é’‰APIç«¯ç‚¹</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #1890ff;
      margin-bottom: 30px;
    }
    .test-section {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid #e8e8e8;
      border-radius: 4px;
      background: #fafafa;
    }
    button {
      background: #1890ff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
    }
    button:hover {
      background: #40a9ff;
    }
    .result {
      margin-top: 15px;
      padding: 15px;
      border-radius: 4px;
      white-space: pre-wrap;
      font-family: monospace;
      font-size: 12px;
    }
    .success {
      background: #f6ffed;
      border: 1px solid #b7eb8f;
      color: #52c41a;
    }
    .error {
      background: #fff1f0;
      border: 1px solid #ffccc7;
      color: #ff4d4f;
    }
    input {
      width: 100%;
      padding: 8px;
      margin: 10px 0;
      border: 1px solid #d9d9d9;
      border-radius: 4px;
      box-sizing: border-box;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” é’‰é’‰APIç«¯ç‚¹æµ‹è¯•å·¥å…·</h1>
    
    <div class="test-section">
      <h3>ğŸ“‹ é…ç½®ä¿¡æ¯</h3>
      <label>Vercelé¡¹ç›®URL:</label>
      <input type="text" id="vercelUrl" placeholder="https://your-project.vercel.app" value="">
      
      <p style="margin-top: 20px; color: #666;">
        â„¹ï¸ è¯·å…ˆå¡«å…¥æ‚¨çš„Vercelé¡¹ç›®åœ°å€ï¼Œç„¶åè¿›è¡Œæµ‹è¯•
      </p>
    </div>

    <div class="test-section">
      <h3>âœ… æµ‹è¯•1: GETè¯·æ±‚éªŒè¯</h3>
      <p>æ¨¡æ‹Ÿé’‰é’‰çš„GETéªŒè¯è¯·æ±‚</p>
      <button onclick="testGetRequest()">æ‰§è¡ŒGETæµ‹è¯•</button>
      <div id="getResult"></div>
    </div>

    <div class="test-section">
      <h3>âœ… æµ‹è¯•2: POSTç©ºè¯·æ±‚éªŒè¯</h3>
      <p>æ¨¡æ‹Ÿé’‰é’‰çš„POSTéªŒè¯è¯·æ±‚ï¼ˆç©ºbodyï¼‰</p>
      <button onclick="testPostEmpty()">æ‰§è¡Œç©ºPOSTæµ‹è¯•</button>
      <div id="postEmptyResult"></div>
    </div>

    <div class="test-section">
      <h3>âœ… æµ‹è¯•3: æ¨¡æ‹Ÿç”¨æˆ·æ¶ˆæ¯</h3>
      <p>æ¨¡æ‹Ÿç”¨æˆ·å‘é€ææŠ¥æ¶ˆæ¯</p>
      <button onclick="testUserMessage()">æ‰§è¡Œæ¶ˆæ¯æµ‹è¯•</button>
      <div id="messageResult"></div>
    </div>

    <div class="test-section">
      <h3>ğŸ“‹ é’‰é’‰é…ç½®æŒ‡å—</h3>
      <ol>
        <li>åœ¨é’‰é’‰å¼€æ”¾å¹³å°ï¼Œè¿›å…¥ <strong>æœºå™¨äººä¸æ¶ˆæ¯æ¨é€</strong></li>
        <li>æ¶ˆæ¯æ¥æ”¶åœ°å€å¡«å†™: <code id="webhookUrl">https://your-project.vercel.app/api/dingtalk-bot</code></li>
        <li>ç‚¹å‡» <strong>ä¿å­˜</strong>ï¼ˆä¼šè‡ªåŠ¨éªŒè¯ï¼‰</li>
        <li>å¦‚æœéªŒè¯é€šè¿‡ï¼Œç‚¹å‡» <strong>å‘å¸ƒ</strong> æŒ‰é’®å‘å¸ƒç‰ˆæœ¬</li>
      </ol>
    </div>
  </div>

  <script>
    // è‡ªåŠ¨å¡«å……å½“å‰åŸŸå
    const currentDomain = window.location.origin;
    if (currentDomain.includes('vercel.app') || currentDomain.includes('localhost')) {
      document.getElementById('vercelUrl').value = currentDomain;
      document.getElementById('webhookUrl').textContent = `${currentDomain}/api/dingtalk-bot`;
    }

    function getApiUrl() {
      const url = document.getElementById('vercelUrl').value.trim();
      if (!url) {
        alert('è¯·å…ˆå¡«å†™Vercelé¡¹ç›®URLï¼');
        return null;
      }
      return url.replace(/\/$/, '') + '/api/dingtalk-bot';
    }

    async function testGetRequest() {
      const resultDiv = document.getElementById('getResult');
      resultDiv.innerHTML = '<div style="color: #1890ff;">â³ æµ‹è¯•ä¸­...</div>';
      
      try {
        const apiUrl = getApiUrl();
        if (!apiUrl) return;
        
        const url = `${apiUrl}?msg_signature=test&timestamp=${Date.now()}&nonce=123456`;
        const response = await fetch(url, {
          method: 'GET',
        });
        
        const data = await response.json();
        
        resultDiv.innerHTML = `<div class="result success">
âœ… GETè¯·æ±‚æˆåŠŸï¼
çŠ¶æ€ç : ${response.status}
å“åº”: ${JSON.stringify(data, null, 2)}

âœ… æ­¤ç«¯ç‚¹å¯ä»¥å“åº”GETè¯·æ±‚
</div>`;
      } catch (error) {
        resultDiv.innerHTML = `<div class="result error">
âŒ GETè¯·æ±‚å¤±è´¥ï¼
é”™è¯¯: ${error.message}

â— è¯·æ£€æŸ¥ï¼š
1. Vercel URLæ˜¯å¦æ­£ç¡®
2. é¡¹ç›®æ˜¯å¦å·²éƒ¨ç½²
3. APIè·¯ç”±æ˜¯å¦é…ç½®æ­£ç¡®
</div>`;
      }
    }

    async function testPostEmpty() {
      const resultDiv = document.getElementById('postEmptyResult');
      resultDiv.innerHTML = '<div style="color: #1890ff;">â³ æµ‹è¯•ä¸­...</div>';
      
      try {
        const apiUrl = getApiUrl();
        if (!apiUrl) return;
        
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({})
        });
        
        const data = await response.json();
        
        resultDiv.innerHTML = `<div class="result success">
âœ… POSTç©ºè¯·æ±‚æˆåŠŸï¼
çŠ¶æ€ç : ${response.status}
å“åº”: ${JSON.stringify(data, null, 2)}

âœ… ç«¯ç‚¹å¯ä»¥æ­£ç¡®å¤„ç†éªŒè¯è¯·æ±‚
</div>`;
      } catch (error) {
        resultDiv.innerHTML = `<div class="result error">
âŒ POSTè¯·æ±‚å¤±è´¥ï¼
é”™è¯¯: ${error.message}
</div>`;
      }
    }

    async function testUserMessage() {
      const resultDiv = document.getElementById('messageResult');
      resultDiv.innerHTML = '<div style="color: #1890ff;">â³ æµ‹è¯•ä¸­...</div>';
      
      try {
        const apiUrl = getApiUrl();
        if (!apiUrl) return;
        
        const testMessage = {
          msgtype: 'text',
          text: {
            content: 'ææŠ¥é—®é¢˜'
          },
          senderId: 'test_user_123',
          senderStaffId: 'test_user_123',
          timestamp: Date.now().toString(),
          sign: 'test_signature'
        };
        
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(testMessage)
        });
        
        const data = await response.json();
        
        if (data.success) {
          resultDiv.innerHTML = `<div class="result success">
âœ… æ¶ˆæ¯å¤„ç†æˆåŠŸï¼
çŠ¶æ€ç : ${response.status}
å“åº”: ${JSON.stringify(data, null, 2)}

âœ… æœºå™¨äººå¯ä»¥æ­£ç¡®å¤„ç†ç”¨æˆ·æ¶ˆæ¯
</div>`;
        } else {
          resultDiv.innerHTML = `<div class="result error">
âš ï¸ æ¶ˆæ¯å¤„ç†è¿”å›å¤±è´¥
å“åº”: ${JSON.stringify(data, null, 2)}
</div>`;
        }
      } catch (error) {
        resultDiv.innerHTML = `<div class="result error">
âŒ æ¶ˆæ¯æµ‹è¯•å¤±è´¥ï¼
é”™è¯¯: ${error.message}
</div>`;
      }
    }
  </script>
</body>
</html>

