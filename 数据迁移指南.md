# 📦 数据迁移指南：localStorage → Supabase

## 🎯 迁移目的

将浏览器 localStorage 中的 Badcase 数据迁移到 Supabase 云数据库，实现：
- ✅ 数据持久化存储
- ✅ 多设备数据同步
- ✅ 实时数据更新
- ✅ 数据备份和恢复

---

## 📋 迁移步骤

### 步骤 1：导出 localStorage 数据

有两种方式导出数据：

#### 方式 A：使用导出工具（推荐）

1. 在浏览器中打开：
   ```
   http://localhost:5173/export-localStorage-data.html
   ```
   或直接打开项目中的 `export-localStorage-data.html` 文件

2. 点击 **"读取 localStorage 数据"** 按钮

3. 点击 **"下载为 JSON 文件"** 按钮，保存为 `localStorage-backup.json`

4. 将下载的文件移动到项目根目录

#### 方式 B：手动导出（备选）

1. 在应用页面打开浏览器开发者工具（F12）

2. 切换到 **Console** 标签

3. 运行以下命令：
   ```javascript
   copy(localStorage.getItem('badcaseList'))
   ```

4. 创建文件 `localStorage-backup.json`，粘贴复制的内容并保存到项目根目录

---

### 步骤 2：安装必要的依赖

确保已安装 TypeScript 执行工具：

```bash
npm install -g tsx
```

或者使用 npx 直接运行（无需全局安装）

---

### 步骤 3：执行迁移脚本

在项目根目录运行：

```bash
npx tsx migrate-to-supabase.ts
```

脚本会：
1. ✅ 检查 Supabase 连接
2. 📂 读取 `localStorage-backup.json` 文件
3. 🚀 批量上传数据到 Supabase
4. 📊 显示迁移结果统计

---

## 📊 迁移过程示例输出

```
🎯 数据迁移工具 - localStorage → Supabase

==================================================
🔍 检查 Supabase 连接...
✅ Supabase 连接成功！

📂 尝试从本地文件读取数据...
✅ 从文件加载了 25 条数据: /path/to/localStorage-backup.json

⚠️ 即将迁移 25 条数据到 Supabase
⚠️ 如果数据已存在，将会被更新

按 Ctrl+C 取消，或等待 5 秒后自动开始...

🚀 开始迁移 25 条数据到 Supabase...
✅ [1/25] 插入成功: BC001
✅ [2/25] 插入成功: BC002
...
✅ [25/25] 插入成功: BC025

📊 迁移完成！
✅ 成功: 25 条
❌ 失败: 0 条

🔍 验证迁移结果...
✅ Supabase 中共有 25 条记录

✅ 迁移流程全部完成！
💡 现在可以刷新浏览器，数据将从 Supabase 加载
```

---

## ✅ 步骤 4：验证迁移结果

1. **刷新浏览器页面**

2. **查看控制台日志**，应该看到：
   ```
   🌐 使用 Supabase 数据库
   ✅ 从 Supabase 加载了 XX 条数据
   ✅ Realtime 订阅成功
   ```

3. **测试功能**：
   - 添加新的 Badcase
   - 编辑现有数据
   - 删除记录
   - 在多个浏览器标签页中打开，验证实时同步

---

## 🔧 常见问题

### Q1: 提示 "未找到本地数据文件"

**解决方案**：
- 确保 `localStorage-backup.json` 文件在项目根目录
- 检查文件名是否完全一致（区分大小写）
- 检查 JSON 格式是否正确

### Q2: Supabase 连接失败

**解决方案**：
1. 检查网络连接
2. 验证 `.env` 文件中的配置：
   ```
   VITE_SUPABASE_URL=https://kdvvkjdwyqzgrskwjwag.supabase.co
   VITE_SUPABASE_ANON_KEY=你的密钥
   ```
3. 确认 Supabase 项目状态正常

### Q3: 部分数据迁移失败

**检查方法**：
- 查看控制台的错误详情
- 常见原因：
  - 数据格式不符合数据库约束
  - 必填字段缺失
  - 字段类型不匹配

**解决方案**：
- 修正数据后重新运行脚本
- 脚本会自动更新已存在的记录

### Q4: 迁移后看不到数据

**解决方案**：
1. 强制刷新浏览器（Ctrl + Shift + R）
2. 清除浏览器缓存
3. 打开开发者工具查看控制台错误
4. 验证 Supabase 中是否确实有数据：
   ```bash
   npx tsx migrate-to-supabase.ts
   ```
   查看 "验证迁移结果" 部分

---

## 🎉 迁移完成后

1. **清理 localStorage**（可选）：
   ```javascript
   // 在浏览器控制台运行
   localStorage.removeItem('badcaseList');
   ```

2. **备份 JSON 文件**：
   将 `localStorage-backup.json` 保存到安全位置作为备份

3. **享受云端数据同步**！
   - 数据自动保存到 Supabase
   - 支持多设备访问
   - 实时数据同步

---

## 📞 需要帮助？

如果遇到问题：
1. 查看控制台日志获取详细错误信息
2. 检查 Supabase 项目的数据表结构
3. 验证数据格式是否符合要求

---

**最后更新**: 2024-12-22

