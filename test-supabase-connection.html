<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase è¿æ¥æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .status.info {
            background: #e3f2fd;
            color: #1976d2;
            border: 1px solid #90caf9;
        }
        
        .status.success {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #81c784;
        }
        
        .status.error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ef9a9a;
        }
        
        .status.warning {
            background: #fff3e0;
            color: #f57c00;
            border: 1px solid #ffb74d;
        }
        
        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        .test-result {
            background: #f5f5f5;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        
        .test-result h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .test-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
            font-size: 13px;
        }
        
        .test-item:last-child {
            border-bottom: none;
        }
        
        .test-key {
            color: #666;
            font-weight: 500;
        }
        
        .test-value {
            color: #333;
            font-family: monospace;
            max-width: 400px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .test-value.success {
            color: #2e7d32;
        }
        
        .test-value.error {
            color: #c62828;
        }
        
        .code-block {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Supabase è¿æ¥æµ‹è¯•</h1>
        <p class="subtitle">æµ‹è¯•æ•°æ®åº“è¿æ¥å’Œç¯å¢ƒé…ç½®</p>
        
        <div id="statusMessage" class="status info">
            â„¹ï¸ å‡†å¤‡å°±ç»ªã€‚ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•ã€‚
        </div>
        
        <div>
            <button onclick="testConnection()">ğŸ” æµ‹è¯•è¿æ¥</button>
            <button onclick="testEnvironment()">âš™ï¸ æ£€æŸ¥ç¯å¢ƒå˜é‡</button>
            <button onclick="testCRUD()">ğŸ“ æµ‹è¯•å¢åˆ æ”¹æŸ¥</button>
            <button onclick="clearLocalStorage()">ğŸ—‘ï¸ æ¸…é™¤ localStorage</button>
        </div>
        
        <div id="testResult" class="test-result"></div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
        
        // Supabase é…ç½®
        const SUPABASE_URL = 'https://bpivzznuvvbafsyvzxqm.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJwaXZ6em51dnZiYWZzeXZ6eHFtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzM0MDg1NjIsImV4cCI6MjA0ODk4NDU2Mn0.cXDE2rwda9N9o_eBSZeW10_YuVNCN6BCHc0kcNCuTRw';
        
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        window.testConnection = async function() {
            const statusDiv = document.getElementById('statusMessage');
            const resultDiv = document.getElementById('testResult');
            
            statusDiv.className = 'status info';
            statusDiv.textContent = 'ğŸ”„ æ­£åœ¨è¿æ¥ Supabase...';
            resultDiv.style.display = 'none';
            
            try {
                const { data, error, count } = await supabase
                    .from('badcases')
                    .select('*', { count: 'exact', head: false });
                
                if (error) {
                    throw error;
                }
                
                statusDiv.className = 'status success';
                statusDiv.textContent = `âœ… è¿æ¥æˆåŠŸï¼æ•°æ®åº“ä¸­æœ‰ ${count} æ¡è®°å½•ã€‚`;
                
                resultDiv.innerHTML = `
                    <h3>ğŸ“Š æ•°æ®åº“ä¿¡æ¯</h3>
                    <div class="test-item">
                        <span class="test-key">è¿æ¥çŠ¶æ€</span>
                        <span class="test-value success">âœ… æˆåŠŸ</span>
                    </div>
                    <div class="test-item">
                        <span class="test-key">è®°å½•æ€»æ•°</span>
                        <span class="test-value">${count}</span>
                    </div>
                    <div class="test-item">
                        <span class="test-key">è¡¨å</span>
                        <span class="test-value">badcases</span>
                    </div>
                    <div class="test-item">
                        <span class="test-key">æœ€æ–°è®°å½•ID</span>
                        <span class="test-value">${data && data.length > 0 ? data[0].id : 'æ— æ•°æ®'}</span>
                    </div>
                `;
                resultDiv.style.display = 'block';
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = `âŒ è¿æ¥å¤±è´¥: ${error.message}`;
                
                resultDiv.innerHTML = `
                    <h3>âŒ é”™è¯¯è¯¦æƒ…</h3>
                    <div class="test-item">
                        <span class="test-key">é”™è¯¯æ¶ˆæ¯</span>
                        <span class="test-value error">${error.message}</span>
                    </div>
                    <div class="test-item">
                        <span class="test-key">å¯èƒ½åŸå› </span>
                        <span class="test-value">æ•°æ®åº“è¡¨ä¸å­˜åœ¨æˆ–ç½‘ç»œè¿æ¥é—®é¢˜</span>
                    </div>
                    <div class="code-block">
                        ${JSON.stringify(error, null, 2)}
                    </div>
                `;
                resultDiv.style.display = 'block';
            }
        };
        
        window.testEnvironment = function() {
            const statusDiv = document.getElementById('statusMessage');
            const resultDiv = document.getElementById('testResult');
            
            const hasViteUrl = typeof import.meta !== 'undefined' && import.meta.env?.VITE_SUPABASE_URL;
            const hasViteKey = typeof import.meta !== 'undefined' && import.meta.env?.VITE_SUPABASE_ANON_KEY;
            
            const urlValue = hasViteUrl ? import.meta.env.VITE_SUPABASE_URL : 'æœªé…ç½®';
            const keyValue = hasViteKey ? 'å·²é…ç½® (é•¿åº¦: ' + import.meta.env.VITE_SUPABASE_ANON_KEY.length + ')' : 'æœªé…ç½®';
            
            if (hasViteUrl && hasViteKey) {
                statusDiv.className = 'status success';
                statusDiv.textContent = 'âœ… ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®ï¼';
            } else {
                statusDiv.className = 'status warning';
                statusDiv.textContent = 'âš ï¸ ç¯å¢ƒå˜é‡æœªé…ç½®æˆ–æœªåŠ è½½ã€‚';
            }
            
            resultDiv.innerHTML = `
                <h3>âš™ï¸ ç¯å¢ƒå˜é‡æ£€æŸ¥</h3>
                <div class="test-item">
                    <span class="test-key">VITE_SUPABASE_URL</span>
                    <span class="test-value ${hasViteUrl ? 'success' : 'error'}">${urlValue}</span>
                </div>
                <div class="test-item">
                    <span class="test-key">VITE_SUPABASE_ANON_KEY</span>
                    <span class="test-value ${hasViteKey ? 'success' : 'error'}">${keyValue}</span>
                </div>
                <div class="test-item">
                    <span class="test-key">è¿è¡Œæ¨¡å¼</span>
                    <span class="test-value">${import.meta.env?.MODE || 'æœªçŸ¥'}</span>
                </div>
                <div class="test-item">
                    <span class="test-key">è¯´æ˜</span>
                    <span class="test-value">æœ¬æµ‹è¯•é¡µé¢ä½¿ç”¨ç¡¬ç¼–ç çš„å¯†é’¥ï¼Œå®é™…åº”ç”¨ä¼šè¯»å–ç¯å¢ƒå˜é‡</span>
                </div>
            `;
            resultDiv.style.display = 'block';
        };
        
        window.testCRUD = async function() {
            const statusDiv = document.getElementById('statusMessage');
            const resultDiv = document.getElementById('testResult');
            
            statusDiv.className = 'status info';
            statusDiv.textContent = 'ğŸ”„ æ­£åœ¨æµ‹è¯• CRUD æ“ä½œ...';
            resultDiv.style.display = 'none';
            
            const testId = 'TEST-' + Date.now();
            const results = [];
            
            try {
                // 1. CREATE
                const { data: created, error: createError } = await supabase
                    .from('badcases')
                    .insert([{
                        id: testId,
                        date: new Date().toISOString().split('T')[0],
                        category: 'æµ‹è¯•åˆ†ç±»',
                        description: 'è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ•°æ®',
                        expected_fix_date: new Date().toISOString().split('T')[0],
                        status: 'pending'
                    }])
                    .select()
                    .single();
                
                if (createError) throw new Error('CREATE å¤±è´¥: ' + createError.message);
                results.push({ operation: 'CREATE', status: 'âœ… æˆåŠŸ', id: testId });
                
                // 2. READ
                const { data: read, error: readError } = await supabase
                    .from('badcases')
                    .select('*')
                    .eq('id', testId)
                    .single();
                
                if (readError) throw new Error('READ å¤±è´¥: ' + readError.message);
                results.push({ operation: 'READ', status: 'âœ… æˆåŠŸ', id: testId });
                
                // 3. UPDATE
                const { data: updated, error: updateError } = await supabase
                    .from('badcases')
                    .update({ description: 'æµ‹è¯•æ•°æ®å·²æ›´æ–°' })
                    .eq('id', testId)
                    .select()
                    .single();
                
                if (updateError) throw new Error('UPDATE å¤±è´¥: ' + updateError.message);
                results.push({ operation: 'UPDATE', status: 'âœ… æˆåŠŸ', id: testId });
                
                // 4. DELETE
                const { error: deleteError } = await supabase
                    .from('badcases')
                    .delete()
                    .eq('id', testId);
                
                if (deleteError) throw new Error('DELETE å¤±è´¥: ' + deleteError.message);
                results.push({ operation: 'DELETE', status: 'âœ… æˆåŠŸ', id: testId });
                
                statusDiv.className = 'status success';
                statusDiv.textContent = 'âœ… CRUD æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼';
                
                resultDiv.innerHTML = `
                    <h3>ğŸ“ CRUD æ“ä½œæµ‹è¯•ç»“æœ</h3>
                    ${results.map(r => `
                        <div class="test-item">
                            <span class="test-key">${r.operation}</span>
                            <span class="test-value success">${r.status}</span>
                        </div>
                    `).join('')}
                    <div class="test-item">
                        <span class="test-key">æµ‹è¯•ID</span>
                        <span class="test-value">${testId}</span>
                    </div>
                `;
                resultDiv.style.display = 'block';
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = `âŒ CRUD æµ‹è¯•å¤±è´¥: ${error.message}`;
                
                resultDiv.innerHTML = `
                    <h3>âŒ æµ‹è¯•å¤±è´¥</h3>
                    ${results.map(r => `
                        <div class="test-item">
                            <span class="test-key">${r.operation}</span>
                            <span class="test-value success">${r.status}</span>
                        </div>
                    `).join('')}
                    <div class="test-item">
                        <span class="test-key">é”™è¯¯æ¶ˆæ¯</span>
                        <span class="test-value error">${error.message}</span>
                    </div>
                `;
                resultDiv.style.display = 'block';
                
                // å°è¯•æ¸…ç†æµ‹è¯•æ•°æ®
                try {
                    await supabase.from('badcases').delete().eq('id', testId);
                } catch {}
            }
        };
        
        window.clearLocalStorage = function() {
            const count = localStorage.length;
            localStorage.clear();
            
            const statusDiv = document.getElementById('statusMessage');
            const resultDiv = document.getElementById('testResult');
            
            statusDiv.className = 'status success';
            statusDiv.textContent = `âœ… å·²æ¸…é™¤ ${count} ä¸ª localStorage é¡¹ç›®`;
            
            resultDiv.innerHTML = `
                <h3>ğŸ—‘ï¸ localStorage å·²æ¸…ç©º</h3>
                <div class="test-item">
                    <span class="test-key">æ¸…é™¤å‰é¡¹ç›®æ•°</span>
                    <span class="test-value">${count}</span>
                </div>
                <div class="test-item">
                    <span class="test-key">æ¸…é™¤åé¡¹ç›®æ•°</span>
                    <span class="test-value">0</span>
                </div>
                <div class="test-item">
                    <span class="test-key">è¯´æ˜</span>
                    <span class="test-value">åˆ·æ–°é¡µé¢å°†ä½¿ç”¨ Supabase æ•°æ®</span>
                </div>
            `;
            resultDiv.style.display = 'block';
        };
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•è¿æ¥
        window.addEventListener('load', () => {
            setTimeout(testConnection, 500);
        });
    </script>
</body>
</html>

